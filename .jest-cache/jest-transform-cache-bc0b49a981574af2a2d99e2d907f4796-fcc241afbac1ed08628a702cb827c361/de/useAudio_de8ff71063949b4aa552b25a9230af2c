2664f5a5b3cab490f62377ef33204b50
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useAudio = void 0;
var _react = require("react");
const useAudio = () => {
  const audioContextRef = (0, _react.useRef)(null);
  const activeOscillatorsRef = (0, _react.useRef)([]);
  const backgroundMusicRef = (0, _react.useRef)(null);

  // Initialize audio context
  const initAudioContext = (0, _react.useCallback)(() => {
    if (!audioContextRef.current) {
      audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
    }
    return audioContextRef.current;
  }, []);

  // Play a single note with ADSR envelope
  const playNote = (0, _react.useCallback)((frequency, duration = 300) => {
    try {
      const audioContext = initAudioContext();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
      oscillator.type = 'sine';
      const now = audioContext.currentTime;

      // ADSR envelope for smoother sound
      gainNode.gain.setValueAtTime(0, now);
      gainNode.gain.linearRampToValueAtTime(0.15, now + 0.01);
      gainNode.gain.exponentialRampToValueAtTime(0.05, now + 0.1);
      gainNode.gain.setValueAtTime(0.05, now + duration / 1000 - 0.1);
      gainNode.gain.exponentialRampToValueAtTime(0.0001, now + duration / 1000);
      oscillator.start(now);
      oscillator.stop(now + duration / 1000);

      // Add to active oscillators array
      activeOscillatorsRef.current.push(oscillator);

      // Remove from active array when note ends
      oscillator.onended = () => {
        activeOscillatorsRef.current = activeOscillatorsRef.current.filter(osc => osc !== oscillator);
      };

      // Clean up old oscillators (keep max 6 simultaneous notes for performance)
      if (activeOscillatorsRef.current.length > 6) {
        const oldestOsc = activeOscillatorsRef.current.shift();
        try {
          oldestOsc.stop();
        } catch (e) {
          // Already stopped
        }
      }
    } catch (error) {
      console.log('Audio playback failed:', error);
    }
  }, [initAudioContext]);

  // Play gentle welcome music
  const playWelcomeMusic = (0, _react.useCallback)(() => {
    const audioContext = initAudioContext();
    const playGentleChord = (frequencies, delay = 0) => {
      setTimeout(() => {
        frequencies.forEach(freq => {
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
          oscillator.type = 'sine';
          const now = audioContext.currentTime;
          gainNode.gain.setValueAtTime(0, now);
          gainNode.gain.linearRampToValueAtTime(0.05, now + 0.2);
          gainNode.gain.exponentialRampToValueAtTime(0.001, now + 2.5);
          oscillator.start(now);
          oscillator.stop(now + 2.5);
        });
      }, delay);
    };

    // Play a softer, more harmonious melody
    playGentleChord([261.63, 329.63, 392.00], 0); // C major chord
    playGentleChord([293.66, 369.99, 440.00], 1200); // D major chord  
    playGentleChord([261.63, 329.63, 392.00], 2400); // C major chord
  }, [initAudioContext]);

  // Play background music with Happy Birthday melody
  const playBackgroundMusic = (0, _react.useCallback)(happyBirthdayNotes => {
    const audioContext = initAudioContext();

    // Stop any existing background music
    if (backgroundMusicRef.current) {
      clearTimeout(backgroundMusicRef.current);
    }
    const playMelodyNote = (noteIndex = 0) => {
      if (noteIndex >= happyBirthdayNotes.length) {
        // Restart melody after a pause
        backgroundMusicRef.current = setTimeout(() => playMelodyNote(0), 2000);
        return;
      }
      const note = happyBirthdayNotes[noteIndex];
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      oscillator.frequency.setValueAtTime(note.frequency, audioContext.currentTime);
      oscillator.type = 'sine';
      const now = audioContext.currentTime;

      // Softer background music volume
      gainNode.gain.setValueAtTime(0, now);
      gainNode.gain.linearRampToValueAtTime(0.08, now + 0.05);
      gainNode.gain.exponentialRampToValueAtTime(0.04, now + 0.2);
      gainNode.gain.setValueAtTime(0.04, now + note.duration / 1000 - 0.1);
      gainNode.gain.exponentialRampToValueAtTime(0.0001, now + note.duration / 1000);
      oscillator.start(now);
      oscillator.stop(now + note.duration / 1000);

      // Schedule next note
      backgroundMusicRef.current = setTimeout(() => playMelodyNote(noteIndex + 1), note.duration);
    };
    playMelodyNote(0);
  }, [initAudioContext]);

  // Stop background music
  const stopBackgroundMusic = (0, _react.useCallback)(() => {
    if (backgroundMusicRef.current) {
      clearTimeout(backgroundMusicRef.current);
      backgroundMusicRef.current = null;
    }
  }, []);

  // Cleanup on unmount
  (0, _react.useEffect)(() => {
    return () => {
      // Stop all active oscillators
      activeOscillatorsRef.current.forEach(osc => {
        try {
          osc.stop();
        } catch (e) {
          // Already stopped
        }
      });

      // Stop background music
      if (backgroundMusicRef.current) {
        clearTimeout(backgroundMusicRef.current);
      }

      // Close audio context
      if (audioContextRef.current && audioContextRef.current.state !== 'closed') {
        audioContextRef.current.close();
      }
    };
  }, []);
  return {
    playNote,
    playWelcomeMusic,
    playBackgroundMusic,
    stopBackgroundMusic,
    initAudioContext
  };
};
exports.useAudio = useAudio;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwidXNlQXVkaW8iLCJhdWRpb0NvbnRleHRSZWYiLCJ1c2VSZWYiLCJhY3RpdmVPc2NpbGxhdG9yc1JlZiIsImJhY2tncm91bmRNdXNpY1JlZiIsImluaXRBdWRpb0NvbnRleHQiLCJ1c2VDYWxsYmFjayIsImN1cnJlbnQiLCJ3aW5kb3ciLCJBdWRpb0NvbnRleHQiLCJ3ZWJraXRBdWRpb0NvbnRleHQiLCJwbGF5Tm90ZSIsImZyZXF1ZW5jeSIsImR1cmF0aW9uIiwiYXVkaW9Db250ZXh0Iiwib3NjaWxsYXRvciIsImNyZWF0ZU9zY2lsbGF0b3IiLCJnYWluTm9kZSIsImNyZWF0ZUdhaW4iLCJjb25uZWN0IiwiZGVzdGluYXRpb24iLCJzZXRWYWx1ZUF0VGltZSIsImN1cnJlbnRUaW1lIiwidHlwZSIsIm5vdyIsImdhaW4iLCJsaW5lYXJSYW1wVG9WYWx1ZUF0VGltZSIsImV4cG9uZW50aWFsUmFtcFRvVmFsdWVBdFRpbWUiLCJzdGFydCIsInN0b3AiLCJwdXNoIiwib25lbmRlZCIsImZpbHRlciIsIm9zYyIsImxlbmd0aCIsIm9sZGVzdE9zYyIsInNoaWZ0IiwiZSIsImVycm9yIiwiY29uc29sZSIsImxvZyIsInBsYXlXZWxjb21lTXVzaWMiLCJwbGF5R2VudGxlQ2hvcmQiLCJmcmVxdWVuY2llcyIsImRlbGF5Iiwic2V0VGltZW91dCIsImZvckVhY2giLCJmcmVxIiwicGxheUJhY2tncm91bmRNdXNpYyIsImhhcHB5QmlydGhkYXlOb3RlcyIsImNsZWFyVGltZW91dCIsInBsYXlNZWxvZHlOb3RlIiwibm90ZUluZGV4Iiwibm90ZSIsInN0b3BCYWNrZ3JvdW5kTXVzaWMiLCJ1c2VFZmZlY3QiLCJzdGF0ZSIsImNsb3NlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInVzZUF1ZGlvLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZVJlZiwgdXNlQ2FsbGJhY2ssIHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0JztcclxuXHJcbmV4cG9ydCBjb25zdCB1c2VBdWRpbyA9ICgpID0+IHtcclxuICBjb25zdCBhdWRpb0NvbnRleHRSZWYgPSB1c2VSZWYobnVsbCk7XHJcbiAgY29uc3QgYWN0aXZlT3NjaWxsYXRvcnNSZWYgPSB1c2VSZWYoW10pO1xyXG4gIGNvbnN0IGJhY2tncm91bmRNdXNpY1JlZiA9IHVzZVJlZihudWxsKTtcclxuXHJcbiAgLy8gSW5pdGlhbGl6ZSBhdWRpbyBjb250ZXh0XHJcbiAgY29uc3QgaW5pdEF1ZGlvQ29udGV4dCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcclxuICAgIGlmICghYXVkaW9Db250ZXh0UmVmLmN1cnJlbnQpIHtcclxuICAgICAgYXVkaW9Db250ZXh0UmVmLmN1cnJlbnQgPSBuZXcgKHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dCkoKTtcclxuICAgIH1cclxuICAgIHJldHVybiBhdWRpb0NvbnRleHRSZWYuY3VycmVudDtcclxuICB9LCBbXSk7XHJcblxyXG4gIC8vIFBsYXkgYSBzaW5nbGUgbm90ZSB3aXRoIEFEU1IgZW52ZWxvcGVcclxuICBjb25zdCBwbGF5Tm90ZSA9IHVzZUNhbGxiYWNrKChmcmVxdWVuY3ksIGR1cmF0aW9uID0gMzAwKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBhdWRpb0NvbnRleHQgPSBpbml0QXVkaW9Db250ZXh0KCk7XHJcbiAgICAgIGNvbnN0IG9zY2lsbGF0b3IgPSBhdWRpb0NvbnRleHQuY3JlYXRlT3NjaWxsYXRvcigpO1xyXG4gICAgICBjb25zdCBnYWluTm9kZSA9IGF1ZGlvQ29udGV4dC5jcmVhdGVHYWluKCk7XHJcbiAgICAgIFxyXG4gICAgICBvc2NpbGxhdG9yLmNvbm5lY3QoZ2Fpbk5vZGUpO1xyXG4gICAgICBnYWluTm9kZS5jb25uZWN0KGF1ZGlvQ29udGV4dC5kZXN0aW5hdGlvbik7XHJcbiAgICAgIFxyXG4gICAgICBvc2NpbGxhdG9yLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZShmcmVxdWVuY3ksIGF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSk7XHJcbiAgICAgIG9zY2lsbGF0b3IudHlwZSA9ICdzaW5lJztcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IG5vdyA9IGF1ZGlvQ29udGV4dC5jdXJyZW50VGltZTtcclxuICAgICAgXHJcbiAgICAgIC8vIEFEU1IgZW52ZWxvcGUgZm9yIHNtb290aGVyIHNvdW5kXHJcbiAgICAgIGdhaW5Ob2RlLmdhaW4uc2V0VmFsdWVBdFRpbWUoMCwgbm93KTtcclxuICAgICAgZ2Fpbk5vZGUuZ2Fpbi5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSgwLjE1LCBub3cgKyAwLjAxKTtcclxuICAgICAgZ2Fpbk5vZGUuZ2Fpbi5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKDAuMDUsIG5vdyArIDAuMSk7XHJcbiAgICAgIGdhaW5Ob2RlLmdhaW4uc2V0VmFsdWVBdFRpbWUoMC4wNSwgbm93ICsgZHVyYXRpb24gLyAxMDAwIC0gMC4xKTtcclxuICAgICAgZ2Fpbk5vZGUuZ2Fpbi5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKDAuMDAwMSwgbm93ICsgZHVyYXRpb24gLyAxMDAwKTtcclxuXHJcbiAgICAgIG9zY2lsbGF0b3Iuc3RhcnQobm93KTtcclxuICAgICAgb3NjaWxsYXRvci5zdG9wKG5vdyArIGR1cmF0aW9uIC8gMTAwMCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBBZGQgdG8gYWN0aXZlIG9zY2lsbGF0b3JzIGFycmF5XHJcbiAgICAgIGFjdGl2ZU9zY2lsbGF0b3JzUmVmLmN1cnJlbnQucHVzaChvc2NpbGxhdG9yKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFJlbW92ZSBmcm9tIGFjdGl2ZSBhcnJheSB3aGVuIG5vdGUgZW5kc1xyXG4gICAgICBvc2NpbGxhdG9yLm9uZW5kZWQgPSAoKSA9PiB7XHJcbiAgICAgICAgYWN0aXZlT3NjaWxsYXRvcnNSZWYuY3VycmVudCA9IGFjdGl2ZU9zY2lsbGF0b3JzUmVmLmN1cnJlbnQuZmlsdGVyKG9zYyA9PiBvc2MgIT09IG9zY2lsbGF0b3IpO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgLy8gQ2xlYW4gdXAgb2xkIG9zY2lsbGF0b3JzIChrZWVwIG1heCA2IHNpbXVsdGFuZW91cyBub3RlcyBmb3IgcGVyZm9ybWFuY2UpXHJcbiAgICAgIGlmIChhY3RpdmVPc2NpbGxhdG9yc1JlZi5jdXJyZW50Lmxlbmd0aCA+IDYpIHtcclxuICAgICAgICBjb25zdCBvbGRlc3RPc2MgPSBhY3RpdmVPc2NpbGxhdG9yc1JlZi5jdXJyZW50LnNoaWZ0KCk7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIG9sZGVzdE9zYy5zdG9wKCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgLy8gQWxyZWFkeSBzdG9wcGVkXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmxvZygnQXVkaW8gcGxheWJhY2sgZmFpbGVkOicsIGVycm9yKTtcclxuICAgIH1cclxuICB9LCBbaW5pdEF1ZGlvQ29udGV4dF0pO1xyXG5cclxuICAvLyBQbGF5IGdlbnRsZSB3ZWxjb21lIG11c2ljXHJcbiAgY29uc3QgcGxheVdlbGNvbWVNdXNpYyA9IHVzZUNhbGxiYWNrKCgpID0+IHtcclxuICAgIGNvbnN0IGF1ZGlvQ29udGV4dCA9IGluaXRBdWRpb0NvbnRleHQoKTtcclxuICAgIFxyXG4gICAgY29uc3QgcGxheUdlbnRsZUNob3JkID0gKGZyZXF1ZW5jaWVzLCBkZWxheSA9IDApID0+IHtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgZnJlcXVlbmNpZXMuZm9yRWFjaCgoZnJlcSkgPT4ge1xyXG4gICAgICAgICAgY29uc3Qgb3NjaWxsYXRvciA9IGF1ZGlvQ29udGV4dC5jcmVhdGVPc2NpbGxhdG9yKCk7XHJcbiAgICAgICAgICBjb25zdCBnYWluTm9kZSA9IGF1ZGlvQ29udGV4dC5jcmVhdGVHYWluKCk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIG9zY2lsbGF0b3IuY29ubmVjdChnYWluTm9kZSk7XHJcbiAgICAgICAgICBnYWluTm9kZS5jb25uZWN0KGF1ZGlvQ29udGV4dC5kZXN0aW5hdGlvbik7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIG9zY2lsbGF0b3IuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKGZyZXEsIGF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSk7XHJcbiAgICAgICAgICBvc2NpbGxhdG9yLnR5cGUgPSAnc2luZSc7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGNvbnN0IG5vdyA9IGF1ZGlvQ29udGV4dC5jdXJyZW50VGltZTtcclxuICAgICAgICAgIGdhaW5Ob2RlLmdhaW4uc2V0VmFsdWVBdFRpbWUoMCwgbm93KTtcclxuICAgICAgICAgIGdhaW5Ob2RlLmdhaW4ubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoMC4wNSwgbm93ICsgMC4yKTtcclxuICAgICAgICAgIGdhaW5Ob2RlLmdhaW4uZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZSgwLjAwMSwgbm93ICsgMi41KTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgb3NjaWxsYXRvci5zdGFydChub3cpO1xyXG4gICAgICAgICAgb3NjaWxsYXRvci5zdG9wKG5vdyArIDIuNSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0sIGRlbGF5KTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gUGxheSBhIHNvZnRlciwgbW9yZSBoYXJtb25pb3VzIG1lbG9keVxyXG4gICAgcGxheUdlbnRsZUNob3JkKFsyNjEuNjMsIDMyOS42MywgMzkyLjAwXSwgMCk7ICAgIC8vIEMgbWFqb3IgY2hvcmRcclxuICAgIHBsYXlHZW50bGVDaG9yZChbMjkzLjY2LCAzNjkuOTksIDQ0MC4wMF0sIDEyMDApOyAvLyBEIG1ham9yIGNob3JkICBcclxuICAgIHBsYXlHZW50bGVDaG9yZChbMjYxLjYzLCAzMjkuNjMsIDM5Mi4wMF0sIDI0MDApOyAvLyBDIG1ham9yIGNob3JkXHJcbiAgfSwgW2luaXRBdWRpb0NvbnRleHRdKTtcclxuXHJcbiAgLy8gUGxheSBiYWNrZ3JvdW5kIG11c2ljIHdpdGggSGFwcHkgQmlydGhkYXkgbWVsb2R5XHJcbiAgY29uc3QgcGxheUJhY2tncm91bmRNdXNpYyA9IHVzZUNhbGxiYWNrKChoYXBweUJpcnRoZGF5Tm90ZXMpID0+IHtcclxuICAgIGNvbnN0IGF1ZGlvQ29udGV4dCA9IGluaXRBdWRpb0NvbnRleHQoKTtcclxuXHJcbiAgICAvLyBTdG9wIGFueSBleGlzdGluZyBiYWNrZ3JvdW5kIG11c2ljXHJcbiAgICBpZiAoYmFja2dyb3VuZE11c2ljUmVmLmN1cnJlbnQpIHtcclxuICAgICAgY2xlYXJUaW1lb3V0KGJhY2tncm91bmRNdXNpY1JlZi5jdXJyZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwbGF5TWVsb2R5Tm90ZSA9IChub3RlSW5kZXggPSAwKSA9PiB7XHJcbiAgICAgIGlmIChub3RlSW5kZXggPj0gaGFwcHlCaXJ0aGRheU5vdGVzLmxlbmd0aCkge1xyXG4gICAgICAgIC8vIFJlc3RhcnQgbWVsb2R5IGFmdGVyIGEgcGF1c2VcclxuICAgICAgICBiYWNrZ3JvdW5kTXVzaWNSZWYuY3VycmVudCA9IHNldFRpbWVvdXQoKCkgPT4gcGxheU1lbG9keU5vdGUoMCksIDIwMDApO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3Qgbm90ZSA9IGhhcHB5QmlydGhkYXlOb3Rlc1tub3RlSW5kZXhdO1xyXG4gICAgICBjb25zdCBvc2NpbGxhdG9yID0gYXVkaW9Db250ZXh0LmNyZWF0ZU9zY2lsbGF0b3IoKTtcclxuICAgICAgY29uc3QgZ2Fpbk5vZGUgPSBhdWRpb0NvbnRleHQuY3JlYXRlR2FpbigpO1xyXG5cclxuICAgICAgb3NjaWxsYXRvci5jb25uZWN0KGdhaW5Ob2RlKTtcclxuICAgICAgZ2Fpbk5vZGUuY29ubmVjdChhdWRpb0NvbnRleHQuZGVzdGluYXRpb24pO1xyXG5cclxuICAgICAgb3NjaWxsYXRvci5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUobm90ZS5mcmVxdWVuY3ksIGF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSk7XHJcbiAgICAgIG9zY2lsbGF0b3IudHlwZSA9ICdzaW5lJztcclxuXHJcbiAgICAgIGNvbnN0IG5vdyA9IGF1ZGlvQ29udGV4dC5jdXJyZW50VGltZTtcclxuICAgICAgXHJcbiAgICAgIC8vIFNvZnRlciBiYWNrZ3JvdW5kIG11c2ljIHZvbHVtZVxyXG4gICAgICBnYWluTm9kZS5nYWluLnNldFZhbHVlQXRUaW1lKDAsIG5vdyk7XHJcbiAgICAgIGdhaW5Ob2RlLmdhaW4ubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoMC4wOCwgbm93ICsgMC4wNSk7XHJcbiAgICAgIGdhaW5Ob2RlLmdhaW4uZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZSgwLjA0LCBub3cgKyAwLjIpO1xyXG4gICAgICBnYWluTm9kZS5nYWluLnNldFZhbHVlQXRUaW1lKDAuMDQsIG5vdyArIG5vdGUuZHVyYXRpb24gLyAxMDAwIC0gMC4xKTtcclxuICAgICAgZ2Fpbk5vZGUuZ2Fpbi5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKDAuMDAwMSwgbm93ICsgbm90ZS5kdXJhdGlvbiAvIDEwMDApO1xyXG5cclxuICAgICAgb3NjaWxsYXRvci5zdGFydChub3cpO1xyXG4gICAgICBvc2NpbGxhdG9yLnN0b3Aobm93ICsgbm90ZS5kdXJhdGlvbiAvIDEwMDApO1xyXG5cclxuICAgICAgLy8gU2NoZWR1bGUgbmV4dCBub3RlXHJcbiAgICAgIGJhY2tncm91bmRNdXNpY1JlZi5jdXJyZW50ID0gc2V0VGltZW91dCgoKSA9PiBwbGF5TWVsb2R5Tm90ZShub3RlSW5kZXggKyAxKSwgbm90ZS5kdXJhdGlvbik7XHJcbiAgICB9O1xyXG5cclxuICAgIHBsYXlNZWxvZHlOb3RlKDApO1xyXG4gIH0sIFtpbml0QXVkaW9Db250ZXh0XSk7XHJcblxyXG4gIC8vIFN0b3AgYmFja2dyb3VuZCBtdXNpY1xyXG4gIGNvbnN0IHN0b3BCYWNrZ3JvdW5kTXVzaWMgPSB1c2VDYWxsYmFjaygoKSA9PiB7XHJcbiAgICBpZiAoYmFja2dyb3VuZE11c2ljUmVmLmN1cnJlbnQpIHtcclxuICAgICAgY2xlYXJUaW1lb3V0KGJhY2tncm91bmRNdXNpY1JlZi5jdXJyZW50KTtcclxuICAgICAgYmFja2dyb3VuZE11c2ljUmVmLmN1cnJlbnQgPSBudWxsO1xyXG4gICAgfVxyXG4gIH0sIFtdKTtcclxuXHJcbiAgLy8gQ2xlYW51cCBvbiB1bm1vdW50XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIC8vIFN0b3AgYWxsIGFjdGl2ZSBvc2NpbGxhdG9yc1xyXG4gICAgICBhY3RpdmVPc2NpbGxhdG9yc1JlZi5jdXJyZW50LmZvckVhY2gob3NjID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgb3NjLnN0b3AoKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAvLyBBbHJlYWR5IHN0b3BwZWRcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gU3RvcCBiYWNrZ3JvdW5kIG11c2ljXHJcbiAgICAgIGlmIChiYWNrZ3JvdW5kTXVzaWNSZWYuY3VycmVudCkge1xyXG4gICAgICAgIGNsZWFyVGltZW91dChiYWNrZ3JvdW5kTXVzaWNSZWYuY3VycmVudCk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIENsb3NlIGF1ZGlvIGNvbnRleHRcclxuICAgICAgaWYgKGF1ZGlvQ29udGV4dFJlZi5jdXJyZW50ICYmIGF1ZGlvQ29udGV4dFJlZi5jdXJyZW50LnN0YXRlICE9PSAnY2xvc2VkJykge1xyXG4gICAgICAgIGF1ZGlvQ29udGV4dFJlZi5jdXJyZW50LmNsb3NlKCk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgfSwgW10pO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgcGxheU5vdGUsXHJcbiAgICBwbGF5V2VsY29tZU11c2ljLFxyXG4gICAgcGxheUJhY2tncm91bmRNdXNpYyxcclxuICAgIHN0b3BCYWNrZ3JvdW5kTXVzaWMsXHJcbiAgICBpbml0QXVkaW9Db250ZXh0XHJcbiAgfTtcclxufTtcclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxNQUFBLEdBQUFDLE9BQUE7QUFFTyxNQUFNQyxRQUFRLEdBQUdBLENBQUEsS0FBTTtFQUM1QixNQUFNQyxlQUFlLEdBQUcsSUFBQUMsYUFBTSxFQUFDLElBQUksQ0FBQztFQUNwQyxNQUFNQyxvQkFBb0IsR0FBRyxJQUFBRCxhQUFNLEVBQUMsRUFBRSxDQUFDO0VBQ3ZDLE1BQU1FLGtCQUFrQixHQUFHLElBQUFGLGFBQU0sRUFBQyxJQUFJLENBQUM7O0VBRXZDO0VBQ0EsTUFBTUcsZ0JBQWdCLEdBQUcsSUFBQUMsa0JBQVcsRUFBQyxNQUFNO0lBQ3pDLElBQUksQ0FBQ0wsZUFBZSxDQUFDTSxPQUFPLEVBQUU7TUFDNUJOLGVBQWUsQ0FBQ00sT0FBTyxHQUFHLEtBQUtDLE1BQU0sQ0FBQ0MsWUFBWSxJQUFJRCxNQUFNLENBQUNFLGtCQUFrQixFQUFFLENBQUM7SUFDcEY7SUFDQSxPQUFPVCxlQUFlLENBQUNNLE9BQU87RUFDaEMsQ0FBQyxFQUFFLEVBQUUsQ0FBQzs7RUFFTjtFQUNBLE1BQU1JLFFBQVEsR0FBRyxJQUFBTCxrQkFBVyxFQUFDLENBQUNNLFNBQVMsRUFBRUMsUUFBUSxHQUFHLEdBQUcsS0FBSztJQUMxRCxJQUFJO01BQ0YsTUFBTUMsWUFBWSxHQUFHVCxnQkFBZ0IsQ0FBQyxDQUFDO01BQ3ZDLE1BQU1VLFVBQVUsR0FBR0QsWUFBWSxDQUFDRSxnQkFBZ0IsQ0FBQyxDQUFDO01BQ2xELE1BQU1DLFFBQVEsR0FBR0gsWUFBWSxDQUFDSSxVQUFVLENBQUMsQ0FBQztNQUUxQ0gsVUFBVSxDQUFDSSxPQUFPLENBQUNGLFFBQVEsQ0FBQztNQUM1QkEsUUFBUSxDQUFDRSxPQUFPLENBQUNMLFlBQVksQ0FBQ00sV0FBVyxDQUFDO01BRTFDTCxVQUFVLENBQUNILFNBQVMsQ0FBQ1MsY0FBYyxDQUFDVCxTQUFTLEVBQUVFLFlBQVksQ0FBQ1EsV0FBVyxDQUFDO01BQ3hFUCxVQUFVLENBQUNRLElBQUksR0FBRyxNQUFNO01BRXhCLE1BQU1DLEdBQUcsR0FBR1YsWUFBWSxDQUFDUSxXQUFXOztNQUVwQztNQUNBTCxRQUFRLENBQUNRLElBQUksQ0FBQ0osY0FBYyxDQUFDLENBQUMsRUFBRUcsR0FBRyxDQUFDO01BQ3BDUCxRQUFRLENBQUNRLElBQUksQ0FBQ0MsdUJBQXVCLENBQUMsSUFBSSxFQUFFRixHQUFHLEdBQUcsSUFBSSxDQUFDO01BQ3ZEUCxRQUFRLENBQUNRLElBQUksQ0FBQ0UsNEJBQTRCLENBQUMsSUFBSSxFQUFFSCxHQUFHLEdBQUcsR0FBRyxDQUFDO01BQzNEUCxRQUFRLENBQUNRLElBQUksQ0FBQ0osY0FBYyxDQUFDLElBQUksRUFBRUcsR0FBRyxHQUFHWCxRQUFRLEdBQUcsSUFBSSxHQUFHLEdBQUcsQ0FBQztNQUMvREksUUFBUSxDQUFDUSxJQUFJLENBQUNFLDRCQUE0QixDQUFDLE1BQU0sRUFBRUgsR0FBRyxHQUFHWCxRQUFRLEdBQUcsSUFBSSxDQUFDO01BRXpFRSxVQUFVLENBQUNhLEtBQUssQ0FBQ0osR0FBRyxDQUFDO01BQ3JCVCxVQUFVLENBQUNjLElBQUksQ0FBQ0wsR0FBRyxHQUFHWCxRQUFRLEdBQUcsSUFBSSxDQUFDOztNQUV0QztNQUNBVixvQkFBb0IsQ0FBQ0ksT0FBTyxDQUFDdUIsSUFBSSxDQUFDZixVQUFVLENBQUM7O01BRTdDO01BQ0FBLFVBQVUsQ0FBQ2dCLE9BQU8sR0FBRyxNQUFNO1FBQ3pCNUIsb0JBQW9CLENBQUNJLE9BQU8sR0FBR0osb0JBQW9CLENBQUNJLE9BQU8sQ0FBQ3lCLE1BQU0sQ0FBQ0MsR0FBRyxJQUFJQSxHQUFHLEtBQUtsQixVQUFVLENBQUM7TUFDL0YsQ0FBQzs7TUFFRDtNQUNBLElBQUlaLG9CQUFvQixDQUFDSSxPQUFPLENBQUMyQixNQUFNLEdBQUcsQ0FBQyxFQUFFO1FBQzNDLE1BQU1DLFNBQVMsR0FBR2hDLG9CQUFvQixDQUFDSSxPQUFPLENBQUM2QixLQUFLLENBQUMsQ0FBQztRQUN0RCxJQUFJO1VBQ0ZELFNBQVMsQ0FBQ04sSUFBSSxDQUFDLENBQUM7UUFDbEIsQ0FBQyxDQUFDLE9BQU9RLENBQUMsRUFBRTtVQUNWO1FBQUE7TUFFSjtJQUNGLENBQUMsQ0FBQyxPQUFPQyxLQUFLLEVBQUU7TUFDZEMsT0FBTyxDQUFDQyxHQUFHLENBQUMsd0JBQXdCLEVBQUVGLEtBQUssQ0FBQztJQUM5QztFQUNGLENBQUMsRUFBRSxDQUFDakMsZ0JBQWdCLENBQUMsQ0FBQzs7RUFFdEI7RUFDQSxNQUFNb0MsZ0JBQWdCLEdBQUcsSUFBQW5DLGtCQUFXLEVBQUMsTUFBTTtJQUN6QyxNQUFNUSxZQUFZLEdBQUdULGdCQUFnQixDQUFDLENBQUM7SUFFdkMsTUFBTXFDLGVBQWUsR0FBR0EsQ0FBQ0MsV0FBVyxFQUFFQyxLQUFLLEdBQUcsQ0FBQyxLQUFLO01BQ2xEQyxVQUFVLENBQUMsTUFBTTtRQUNmRixXQUFXLENBQUNHLE9BQU8sQ0FBRUMsSUFBSSxJQUFLO1VBQzVCLE1BQU1oQyxVQUFVLEdBQUdELFlBQVksQ0FBQ0UsZ0JBQWdCLENBQUMsQ0FBQztVQUNsRCxNQUFNQyxRQUFRLEdBQUdILFlBQVksQ0FBQ0ksVUFBVSxDQUFDLENBQUM7VUFFMUNILFVBQVUsQ0FBQ0ksT0FBTyxDQUFDRixRQUFRLENBQUM7VUFDNUJBLFFBQVEsQ0FBQ0UsT0FBTyxDQUFDTCxZQUFZLENBQUNNLFdBQVcsQ0FBQztVQUUxQ0wsVUFBVSxDQUFDSCxTQUFTLENBQUNTLGNBQWMsQ0FBQzBCLElBQUksRUFBRWpDLFlBQVksQ0FBQ1EsV0FBVyxDQUFDO1VBQ25FUCxVQUFVLENBQUNRLElBQUksR0FBRyxNQUFNO1VBRXhCLE1BQU1DLEdBQUcsR0FBR1YsWUFBWSxDQUFDUSxXQUFXO1VBQ3BDTCxRQUFRLENBQUNRLElBQUksQ0FBQ0osY0FBYyxDQUFDLENBQUMsRUFBRUcsR0FBRyxDQUFDO1VBQ3BDUCxRQUFRLENBQUNRLElBQUksQ0FBQ0MsdUJBQXVCLENBQUMsSUFBSSxFQUFFRixHQUFHLEdBQUcsR0FBRyxDQUFDO1VBQ3REUCxRQUFRLENBQUNRLElBQUksQ0FBQ0UsNEJBQTRCLENBQUMsS0FBSyxFQUFFSCxHQUFHLEdBQUcsR0FBRyxDQUFDO1VBRTVEVCxVQUFVLENBQUNhLEtBQUssQ0FBQ0osR0FBRyxDQUFDO1VBQ3JCVCxVQUFVLENBQUNjLElBQUksQ0FBQ0wsR0FBRyxHQUFHLEdBQUcsQ0FBQztRQUM1QixDQUFDLENBQUM7TUFDSixDQUFDLEVBQUVvQixLQUFLLENBQUM7SUFDWCxDQUFDOztJQUVEO0lBQ0FGLGVBQWUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBSTtJQUNqREEsZUFBZSxDQUFDLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ2pEQSxlQUFlLENBQUMsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7RUFDbkQsQ0FBQyxFQUFFLENBQUNyQyxnQkFBZ0IsQ0FBQyxDQUFDOztFQUV0QjtFQUNBLE1BQU0yQyxtQkFBbUIsR0FBRyxJQUFBMUMsa0JBQVcsRUFBRTJDLGtCQUFrQixJQUFLO0lBQzlELE1BQU1uQyxZQUFZLEdBQUdULGdCQUFnQixDQUFDLENBQUM7O0lBRXZDO0lBQ0EsSUFBSUQsa0JBQWtCLENBQUNHLE9BQU8sRUFBRTtNQUM5QjJDLFlBQVksQ0FBQzlDLGtCQUFrQixDQUFDRyxPQUFPLENBQUM7SUFDMUM7SUFFQSxNQUFNNEMsY0FBYyxHQUFHQSxDQUFDQyxTQUFTLEdBQUcsQ0FBQyxLQUFLO01BQ3hDLElBQUlBLFNBQVMsSUFBSUgsa0JBQWtCLENBQUNmLE1BQU0sRUFBRTtRQUMxQztRQUNBOUIsa0JBQWtCLENBQUNHLE9BQU8sR0FBR3NDLFVBQVUsQ0FBQyxNQUFNTSxjQUFjLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDO1FBQ3RFO01BQ0Y7TUFFQSxNQUFNRSxJQUFJLEdBQUdKLGtCQUFrQixDQUFDRyxTQUFTLENBQUM7TUFDMUMsTUFBTXJDLFVBQVUsR0FBR0QsWUFBWSxDQUFDRSxnQkFBZ0IsQ0FBQyxDQUFDO01BQ2xELE1BQU1DLFFBQVEsR0FBR0gsWUFBWSxDQUFDSSxVQUFVLENBQUMsQ0FBQztNQUUxQ0gsVUFBVSxDQUFDSSxPQUFPLENBQUNGLFFBQVEsQ0FBQztNQUM1QkEsUUFBUSxDQUFDRSxPQUFPLENBQUNMLFlBQVksQ0FBQ00sV0FBVyxDQUFDO01BRTFDTCxVQUFVLENBQUNILFNBQVMsQ0FBQ1MsY0FBYyxDQUFDZ0MsSUFBSSxDQUFDekMsU0FBUyxFQUFFRSxZQUFZLENBQUNRLFdBQVcsQ0FBQztNQUM3RVAsVUFBVSxDQUFDUSxJQUFJLEdBQUcsTUFBTTtNQUV4QixNQUFNQyxHQUFHLEdBQUdWLFlBQVksQ0FBQ1EsV0FBVzs7TUFFcEM7TUFDQUwsUUFBUSxDQUFDUSxJQUFJLENBQUNKLGNBQWMsQ0FBQyxDQUFDLEVBQUVHLEdBQUcsQ0FBQztNQUNwQ1AsUUFBUSxDQUFDUSxJQUFJLENBQUNDLHVCQUF1QixDQUFDLElBQUksRUFBRUYsR0FBRyxHQUFHLElBQUksQ0FBQztNQUN2RFAsUUFBUSxDQUFDUSxJQUFJLENBQUNFLDRCQUE0QixDQUFDLElBQUksRUFBRUgsR0FBRyxHQUFHLEdBQUcsQ0FBQztNQUMzRFAsUUFBUSxDQUFDUSxJQUFJLENBQUNKLGNBQWMsQ0FBQyxJQUFJLEVBQUVHLEdBQUcsR0FBRzZCLElBQUksQ0FBQ3hDLFFBQVEsR0FBRyxJQUFJLEdBQUcsR0FBRyxDQUFDO01BQ3BFSSxRQUFRLENBQUNRLElBQUksQ0FBQ0UsNEJBQTRCLENBQUMsTUFBTSxFQUFFSCxHQUFHLEdBQUc2QixJQUFJLENBQUN4QyxRQUFRLEdBQUcsSUFBSSxDQUFDO01BRTlFRSxVQUFVLENBQUNhLEtBQUssQ0FBQ0osR0FBRyxDQUFDO01BQ3JCVCxVQUFVLENBQUNjLElBQUksQ0FBQ0wsR0FBRyxHQUFHNkIsSUFBSSxDQUFDeEMsUUFBUSxHQUFHLElBQUksQ0FBQzs7TUFFM0M7TUFDQVQsa0JBQWtCLENBQUNHLE9BQU8sR0FBR3NDLFVBQVUsQ0FBQyxNQUFNTSxjQUFjLENBQUNDLFNBQVMsR0FBRyxDQUFDLENBQUMsRUFBRUMsSUFBSSxDQUFDeEMsUUFBUSxDQUFDO0lBQzdGLENBQUM7SUFFRHNDLGNBQWMsQ0FBQyxDQUFDLENBQUM7RUFDbkIsQ0FBQyxFQUFFLENBQUM5QyxnQkFBZ0IsQ0FBQyxDQUFDOztFQUV0QjtFQUNBLE1BQU1pRCxtQkFBbUIsR0FBRyxJQUFBaEQsa0JBQVcsRUFBQyxNQUFNO0lBQzVDLElBQUlGLGtCQUFrQixDQUFDRyxPQUFPLEVBQUU7TUFDOUIyQyxZQUFZLENBQUM5QyxrQkFBa0IsQ0FBQ0csT0FBTyxDQUFDO01BQ3hDSCxrQkFBa0IsQ0FBQ0csT0FBTyxHQUFHLElBQUk7SUFDbkM7RUFDRixDQUFDLEVBQUUsRUFBRSxDQUFDOztFQUVOO0VBQ0EsSUFBQWdELGdCQUFTLEVBQUMsTUFBTTtJQUNkLE9BQU8sTUFBTTtNQUNYO01BQ0FwRCxvQkFBb0IsQ0FBQ0ksT0FBTyxDQUFDdUMsT0FBTyxDQUFDYixHQUFHLElBQUk7UUFDMUMsSUFBSTtVQUNGQSxHQUFHLENBQUNKLElBQUksQ0FBQyxDQUFDO1FBQ1osQ0FBQyxDQUFDLE9BQU9RLENBQUMsRUFBRTtVQUNWO1FBQUE7TUFFSixDQUFDLENBQUM7O01BRUY7TUFDQSxJQUFJakMsa0JBQWtCLENBQUNHLE9BQU8sRUFBRTtRQUM5QjJDLFlBQVksQ0FBQzlDLGtCQUFrQixDQUFDRyxPQUFPLENBQUM7TUFDMUM7O01BRUE7TUFDQSxJQUFJTixlQUFlLENBQUNNLE9BQU8sSUFBSU4sZUFBZSxDQUFDTSxPQUFPLENBQUNpRCxLQUFLLEtBQUssUUFBUSxFQUFFO1FBQ3pFdkQsZUFBZSxDQUFDTSxPQUFPLENBQUNrRCxLQUFLLENBQUMsQ0FBQztNQUNqQztJQUNGLENBQUM7RUFDSCxDQUFDLEVBQUUsRUFBRSxDQUFDO0VBRU4sT0FBTztJQUNMOUMsUUFBUTtJQUNSOEIsZ0JBQWdCO0lBQ2hCTyxtQkFBbUI7SUFDbkJNLG1CQUFtQjtJQUNuQmpEO0VBQ0YsQ0FBQztBQUNILENBQUM7QUFBQ3FELE9BQUEsQ0FBQTFELFFBQUEsR0FBQUEsUUFBQSIsImlnbm9yZUxpc3QiOltdfQ==